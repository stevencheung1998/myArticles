# 浏览器缓存与Http协议

>相关资料：
>
>1、https://www.bilibili.com/video/BV1gf4y1V7CH/?spm_id_from=333.788.recommend_more_video.1&vd_source=30646ef6dc77bb8d42e677f79c411d53
>
>2、https://www.bilibili.com/video/BV1iZ4y1B7Gx?spm_id_from=333.337.search-card.all.click&vd_source=30646ef6dc77bb8d42e677f79c411d53

## 浏览器缓存

在进行web开发的时候，我们为了提高用户的体验优化，常常会使用到缓存技术。而前端中使用最多的缓存有`外部缓存`和`HTTP协议标头`。项目优化直接影响用户体验，缓存可以有效优化用户访问速度。

当网页需要资源的时候，首先会访问`外部缓存`（浏览器缓存）。如果缓存中没有才会请求服务器端。服务器端会进行响应，浏览器会对服务器返回的资源进行`缓存`。**当网页再次需要资源的时候，就会优先从外部资源中返回请求**。这样做的好处：

- 提升请求响应的速度（优先从外部缓存中读取，无需再次请求服务器）
- 降低服务器带宽占比（减少了请求，带宽占比自然少了）
- 降低服务器资源占用（请求服务器端的次数变少）、



## 缓存的位置

从客户端（浏览器）请求的发生到请求资源的接收方（源服务器）。我们大概可以在如下三个地方设置缓存：

>1. 浏览器缓存
>2. 代理服务器缓存
>3. 源服务器缓存

| 浏览器     | 源服务器             | 新鲜度       | 检验值         |    缓存失效    |
| ---------- | -------------------- | ------------ | -------------- | :------------: |
| 资源请求方 | 内容真正来源的服务器 | 缓存时常限制 | 缓存内容的对比 | 缓存试下的更新 |

了解了上述的概念之后，我们还需要知道`HTTP标头`。我们目前都是基于HTTP协议的通讯方式，所以内容的`缓存策略`都是在`HTTP标头`中设置的。

新鲜度：expores、pragma、cache-control

检验值：Etag、if-none-match、if-mdify、if-modified-since

强缓存：强缓存指的就是新鲜度

协商缓存：协商缓存就是校验值（检验）

> - f5 刷新会暂时禁用强缓存
>
> - ctrl+f5会暂时禁用所有缓存策略

> 注意：响应体是`304 状态码`是从服务器返回，表示最新的资源跟缓存的资源一致，直接从缓存中读取

## 各种资源常用的缓存策略

一种比较通用的方法：

- html：设置协商缓存

- js、css、png: 设置强缓存可以设置一年的有效期（但是需要使用hash。确保每次引用的都是最新的资源）
- 接口：根据业务需要自行设置